/*
  Minimalny „diagnostyczny” skrypt zastępczy dla <model-viewer> (tryb offline).

  UWAGA: To NIE jest prawdziwy @google/model-viewer i NIE renderuje modeli GLB/GLTF.
  Celem skryptu jest:
   - zarejestrować element custom elements 'model-viewer', żeby uniknąć czarnego ekranu,
   - wyświetlić czytelny komunikat wewnątrz elementu,
   - wysłać zdarzenie 'error', które może przechwycić aplikacja (overlay z informacją).

  Jak uruchomić prawdziwy rendering:
   - Pobierz plik: node_modules/@google/model-viewer/dist/model-viewer.min.js
   - Skopiuj go tutaj: app/src/main/assets/vendor/model-viewer/model-viewer.min.js (zastąp ten plik)
*/

(() => {
  const TAG = 'model-viewer';
  if (window.customElements && !customElements.get(TAG)) {
    class DiagnosticModelViewer extends HTMLElement {
      constructor() {
        super();
        this._shadow = this.attachShadow({ mode: 'open' });
      }
      connectedCallback() {
        const src = this.getAttribute('src') || '';
        const wrap = document.createElement('div');
        wrap.setAttribute('part', 'container');
        wrap.style.cssText = [
          'box-sizing:border-box',
          'position:relative',
          'display:block',
          'width:100%',
          'height:100%',
          'background:#111',
          'color:#ddd',
          'font:14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, sans-serif',
          'padding:16px',
        ].join(';');
        const msg = document.createElement('div');
        msg.innerHTML = [
          '<b>Tryb diagnostyczny</b><br/>',
          'Ten projekt nie zawiera prawdziwego skryptu <code>@google/model-viewer</code>.<br/>',
          'Aktualny plik to tylko zastępnik – nie renderuje 3D.<br/><br/>',
          'Ścieżka modelu: <code>' + (src || '(brak)') + '</code><br/><br/>',
          'Aby włączyć rendering offline, podmień ten plik na oryginalny:<br/>',
          '<code>app/src/main/assets/vendor/model-viewer/model-viewer.min.js</code>'
        ].join('');
        wrap.appendChild(msg);
        this._shadow.innerHTML = '';
        this._shadow.appendChild(wrap);
        // Wyemituj zdarzenie 'error', by aplikacja mogła pokazać overlay
        setTimeout(() => {
          try { this.dispatchEvent(new Event('error')); } catch (_) {}
          try { console.warn('[diagnostic model-viewer] Brak właściwego skryptu – podmień plik w assets/vendor/model-viewer/'); } catch (_) {}
        }, 0);
      }
    }
    try {
      customElements.define(TAG, DiagnosticModelViewer);
    } catch (e) {
      try { console.error('[diagnostic model-viewer] Nie udało się zarejestrować elementu:', e); } catch (_) {}
    }
  }
})();

export {};
